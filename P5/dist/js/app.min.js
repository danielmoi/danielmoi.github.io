"use strict";function initMap(){return"undefined"==typeof google?(console.log("NO GOOGLE!"),void ko.applyBindings(errorModel,document.getElementById("google-error"))):void ko.applyBindings(new ViewModel)}var model=[{}],ViewModel=function(){var e=this;e.markerIconStar={url:"img/coffee_star_32.png"},e.markerIconNormal={url:"img/coffee_normal_32.png"},e.mapOptions={center:{lat:35.667,lng:139.762},zoom:16,zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_BOTTOM},mapTypeId:google.maps.MapTypeId.ROADMAP,streetViewControl:!1,styles:[{featureType:"poi",stylers:[{visibility:"off"}]}]},e.myMap=new google.maps.Map(document.getElementById("map"),e.mapOptions),e.myInfo=new google.maps.InfoWindow({maxWidth:200}),e.bounds=new google.maps.LatLngBounds,e.widthMagic=ko.computed(function(){return e.mapWidth=ko.observable(window.innerWidth),e.mapWidth()<600&&e.myMap.addListener("click",function(){e.navHide()}),e.mapWidth()}),window.onresize=function(){e.myMap.fitBounds(e.bounds),e.widthMagic()},e.myMap.addListener("click",function(){e.myInfo.close()}),e.city=ko.observable("Tokyo"),e.cafeArray=ko.observableArray(),e.start="https://api.foursquare.com/v2/venues/explore?",e.client_id="client_id=J4JTA0KKSKB50R1ONPYB3W4H532SPS403IHJKL4VQMNMNKT0",e.client_secret="&client_secret=W5FBT3FTE1X4RVJXPSJJDNNXCYHXL0OMH1TPVINZ40NO0LX5",e.location=ko.computed(function(){return"&near="+e.city()}),e.limit="&limit=20",e.v="&v=20140806",e.m="&m=foursquare",e.section="&section=coffee",e.venuePhotos="&venuePhotos=1",e.radius="&radius=1000",e.filterValue=ko.observable(""),e.filterValueLower=ko.observable(e.filterValue().toLowerCase()),e.filterStuff=ko.computed(function(){var o,r=e.cafeArray().length,n=e.filterValue().toLowerCase();for(o=0;r>o;o++){e.myInfo.close();var t=e.cafeArray()[o].name.toLowerCase();t.indexOf(n)<0?(e.cafeArray()[o].marker.setVisible(!1),e.cafeArray()[o].visible(!1)):(e.cafeArray()[o].marker.setVisible(!0),e.cafeArray()[o].visible(!0))}}),e.clearFilter=function(){e.filterValue("")},e.isNavClosed=ko.observable(!1),e.navClick=function(){e.isNavClosed(!e.isNavClosed())},e.navHide=function(){e.isNavClosed(!0)},e.googleError=ko.observable(""),e.messageSystem=ko.observable("no errors to report"),e.messageUser=ko.observable(),e.getStuff=function(){return e.googleError(""),"undefined"==typeof google?void e.googleError("sorry, something went wrong with Google Maps... try again soon!"):void $.ajax({url:e.start+e.client_id+e.client_secret+e.location()+e.v+e.m+e.limit+e.section+e.venuePhotos+e.radius}).done(function(o){e.filterValue(""),e.cafeArray([]),e.messageSystem(""),e.messageUser(""),e.bounds=new google.maps.LatLngBounds,e.mapOptions.center=o.response.geocode.center;var r,n=o.response.groups[0].items,t=n.length;for(r=0;t>r;r++)e.cafeArray.push(new Cafe(n,r,e))}).fail(function(o,r,n){return"undefined"==typeof google?void e.googleError("sorry, something went wrong with Google Maps... try again soon!"):(e.myMap=new google.maps.Map(document.getElementById("map"),e.mapOptions),e.messageSystem('system error: "'+r+"â€“"+n+'"'),void e.messageUser("sorry, something went wrong... try a different location!"))})},e.getStuff()},Cafe=function(e,o,r){var n=this;n.name=e[o].venue.name,n.lat=e[o].venue.location.lat,n.lng=e[o].venue.location.lng,n.rating=e[o].venue.rating,n.visible=ko.observable(!0),n.isSelected=ko.observable(!1),r.messageSystem("no errors to report"),e[o].venue.featuredPhotos?n.photoURL=e[o].venue.featuredPhotos.items[0].prefix+"height200"+e[o].venue.featuredPhotos.items[0].suffix:(r.messageSystem("sorry, no featured photos available"),n.photoURL="#"),n.rating>8.5?n.marker=new google.maps.Marker({map:r.myMap,position:{lat:n.lat,lng:n.lng},icon:r.markerIconStar,title:n.name}):n.marker=new google.maps.Marker({map:r.myMap,position:{lat:n.lat,lng:n.lng},icon:r.markerIconNormal,title:n.name}),n.marker.addListener("click",function(){r.myInfo.setContent("<h3>"+n.name+'</h3><img src="img/foursquare-icon-16x16.png"> Rating: '+n.rating+'<br><img src="'+n.photoURL+'">'),r.myInfo.open(r.myMap,n.marker),r.mapOptions.center=n.marker,r.myMap.panTo(n.marker.position);var e=r.myMap.getDiv();r.myMap.panBy(0,-e.offsetHeight/5),n.marker.setAnimation(google.maps.Animation.BOUNCE),window.setTimeout(function(){n.marker.setAnimation(null)},1400);var o;for(o=0;o<r.cafeArray().length;o++)r.cafeArray()[o].isSelected(!1);n.isSelected(!0),r.mapWidth()<600&&r.navHide()}),n.listClick=function(){google.maps.event.trigger(n.marker,"click")},r.bounds.extend(new google.maps.LatLng(n.lat,n.lng)),r.myMap.fitBounds(r.bounds)},errorModel={googleError:ko.observable("sorry, something went wrong with Google Maps... try again soon!")};